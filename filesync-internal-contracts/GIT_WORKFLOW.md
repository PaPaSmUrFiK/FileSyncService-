# –†–∞–±–æ—Ç–∞ —Å filesync-internal-contracts

## –ß—Ç–æ —ç—Ç–æ?

`filesync-internal-contracts` - —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π Go –º–æ–¥—É–ª—å, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
- **Proto —Ñ–∞–π–ª—ã** (`proto/`) - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è gRPC –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
- **–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥** (`gen/`) - Go –∫–æ–¥, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–∑ proto —Ñ–∞–π–ª–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
filesync-internal-contracts/
‚îú‚îÄ‚îÄ proto/                    # –ò—Å—Ö–æ–¥–Ω—ã–µ .proto —Ñ–∞–π–ª—ã (–∫–æ–º–º–∏—Ç–∏–º –≤ Git)
‚îÇ   ‚îî‚îÄ‚îÄ filesync/
‚îÇ       ‚îú‚îÄ‚îÄ storage/v1/
‚îÇ       ‚îî‚îÄ‚îÄ sync/v1/
‚îú‚îÄ‚îÄ gen/                      # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (–ù–ï –∫–æ–º–º–∏—Ç–∏–º)
‚îÇ   ‚îî‚îÄ‚îÄ go/
‚îú‚îÄ‚îÄ go.mod                    # Go module definition
‚îú‚îÄ‚îÄ go.sum                    # Go dependencies
‚îú‚îÄ‚îÄ Taskfile.yaml             # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
‚îî‚îÄ‚îÄ .gitignore                # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç gen/ –∏ –¥—Ä—É–≥–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
```

## –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Git Workflow

### 1. –ß—Ç–æ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git

‚úÖ **–ö–û–ú–ú–ò–¢–ò–ú:**
- `proto/` - –≤—Å–µ .proto —Ñ–∞–π–ª—ã
- `go.mod` –∏ `go.sum`
- `Taskfile.yaml`
- `.gitignore`
- `README.md` (–µ—Å–ª–∏ –µ—Å—Ç—å)

‚ùå **–ù–ï –ö–û–ú–ú–ò–¢–ò–ú:**
- `gen/` - —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (–±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω –∏–∑ proto)
- `.idea/`, `.vscode/` - IDE —Ñ–∞–π–ª—ã
- –ë–∏–Ω–∞—Ä–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –ª–æ–≥–∏

### 2. Workflow –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã:

```bash
# 1. –í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ .proto —Ñ–∞–π–ª—ã
cd filesync-internal-contracts
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º proto/filesync/storage/v1/storage.proto

# 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å Go –∫–æ–¥
task generate
# –∏–ª–∏
task gen

# 3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –¢–û–õ–¨–ö–û .proto —Ñ–∞–π–ª—ã
git add proto/
git commit -m "feat: add new RPC method to storage service"
git push
```

#### –ö–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª—è—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:

```bash
# –í StorageService –∏–ª–∏ SyncService
cd StorageService

# –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
go get github.com/PaPaSmUrFiK/FileSyncService-/filesync-internal-contracts@latest

# –ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é/–∫–æ–º–º–∏—Ç
go get github.com/PaPaSmUrFiK/FileSyncService-/filesync-internal-contracts@v1.2.3

# –û–±–Ω–æ–≤–∏—Ç—å go.mod –∏ go.sum
go mod tidy

# –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add go.mod go.sum
git commit -m "chore: update internal contracts"
```

### 3. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Git —Ç–µ–≥–∏:

```bash
# –ü–æ—Å–ª–µ –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö
cd filesync-internal-contracts

# –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥ –≤–µ—Ä—Å–∏–∏
git tag v1.0.0
git push origin v1.0.0

# –¢–µ–ø–µ—Ä—å –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é
# –í –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö:
go get github.com/PaPaSmUrFiK/FileSyncService-/filesync-internal-contracts@v1.0.0
```

### 4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ï—Å–ª–∏ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –ø—É—à–∏—Ç—å –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:

```bash
# –í StorageService –∏–ª–∏ SyncService
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ replace directive –≤ go.mod

# –î–æ–±–∞–≤—å—Ç–µ –≤ go.mod:
replace github.com/PaPaSmUrFiK/FileSyncService-/filesync-internal-contracts => ../filesync-internal-contracts

# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —É–±–µ—Ä–∏—Ç–µ replace –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
```

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞

- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (`gen/`) **–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—Å—è** –≤ Git
- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã, –¥–æ–ª–∂–µ–Ω —Å–∞–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –∏–∑ –º–æ–¥—É–ª—è (–µ—Å–ª–∏ –æ–Ω –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω)

### üîÑ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ .proto —Ñ–∞–π–ª–æ–≤ –ø–æ–º–Ω–∏—Ç–µ –æ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
- –ù–µ —É–¥–∞–ª—è–π—Ç–µ –ø–æ–ª—è, –ø–æ–º–µ—á–∞–π—Ç–µ –∫–∞–∫ deprecated
- –ù–µ –º–µ–Ω—è–π—Ç–µ –Ω–æ–º–µ—Ä–∞ –ø–æ–ª–µ–π
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –ø–æ–ª—è —Å –Ω–æ–≤—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `reserved` –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π

### üì¶ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –º–æ–¥—É–ª—è

–ï—Å–ª–∏ –º–æ–¥—É–ª—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π (–≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ):
```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Git –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
git config --global url."https://github.com/".insteadOf "git@github.com:"

# –í –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GOPRIVATE
export GOPRIVATE=github.com/PaPaSmUrFiK/*
```

## –ü—Ä–∏–º–µ—Ä: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ RPC –º–µ—Ç–æ–¥–∞

### 1. –ò–∑–º–µ–Ω–∏—Ç—å proto —Ñ–∞–π–ª

```protobuf
// proto/filesync/storage/v1/storage.proto
service StorageService {
    // –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã...
    
    // –ù–æ–≤—ã–π –º–µ—Ç–æ–¥
    rpc GetFileMetadata(GetFileMetadataRequest) returns (FileMetadata);
}

message GetFileMetadataRequest {
    string file_id = 1;
}

message FileMetadata {
    string file_id = 1;
    string name = 2;
    int64 size = 3;
}
```

### 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥

```bash
task generate
```

### 3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å

```bash
git add proto/filesync/storage/v1/storage.proto
git commit -m "feat(storage): add GetFileMetadata RPC method"
git tag v1.1.0
git push origin main --tags
```

### 4. –û–±–Ω–æ–≤–∏—Ç—å –≤ StorageService

```bash
cd ../StorageService
go get github.com/PaPaSmUrFiK/FileSyncService-/filesync-internal-contracts@v1.1.0
go mod tidy
```

## –†–µ–∑—é–º–µ

1. ‚úÖ –ö–æ–º–º–∏—Ç—å—Ç–µ —Ç–æ–ª—å–∫–æ `.proto` —Ñ–∞–π–ª—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
2. ‚ùå –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (`gen/`)
3. üè∑Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Git —Ç–µ–≥–∏ –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
4. üîÑ –û–±–Ω–æ–≤–ª—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö —á–µ—Ä–µ–∑ `go get`
5. üîí –°–æ–±–ª—é–¥–∞–π—Ç–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
